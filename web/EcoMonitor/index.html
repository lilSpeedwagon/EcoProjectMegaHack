<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    
    <link rel="stylesheet" href="styles/style.css">
    <title>Eco Project</title>
</head>
    <body>
        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        
        <!-- here API -->
        <meta name="viewport" content="initial-scale=1.0, 
        width=device-width" />
        <script src="http://js.api.here.com/v3/3.0/mapsjs-core.js" 
        type="text/javascript" charset="utf-8"></script>
        <script src="http://js.api.here.com/v3/3.0/mapsjs-service.js" 
        type="text/javascript" charset="utf-8"></script>
        <script src="https://js.cit.api.here.com/v3/3.0/mapsjs-mapevents.js"
        type="text/javascript" ></script>
                

        <nav class="navbar navbar-dark bg-secondary navbar-expand-lg justify-content-between" id="navbar-custom">
            <div class="navbar-brand col-4">
                <a class="brand text-light" href="index.html">EcoProject</a>
            </div>
        </nav>

        <div id='container' class='container-fluid bg-dark text-light'>
            <div class='row'>
                <div class='col-4'>
                    <div class='col m-2'>
                        <h5 id='device_name'>Название устройства</h5>
                        <ul class='list-unstyled'>
                            <li>ID устройства: <span id='id_value'></span></li>
                            <li>Координаты: <span id='xy_value'></span></li>
                            <li>Расположение: <span id='location_value'></span></li>
                            <li>Температура: <span id='temp_value'></span></li>
                            <li>Загрязненность воздуха: <span id='pollution_value'></span></li>
                        </ul>
                    </div>
                    <div class='m-2' id='temp_chart'></div>   
                    <div class='m-2' id='pol_chart'></div> 
                </div>
                <div class='col-8'>
                    <div id="map"></div>
                    <!-- <iframe id='map' src="https://xyz.here.com/viewer/?project_id=e2b32c84-1aa6-4b9a-8fd9-51c052643d2d" frameborder="0"></iframe> -->
                </div>
            </div>    
        </div>
        
        <footer class='container-fluid bg-secondary text-dark'>
            <ul class='list-inline'>
                <li class='list-inline-item'>Future Gadgets Lab</li>
                <li class='list-inline-item'>2019</li>
            </ul>
        </footer>
        
        <script>
            var currentDevice = undefined;
            var data = [{
                x: 10,
                y: 5
            }, {
                x: 15,
                y: 10   
            }];
            var id_value = document.getElementById('id_value');
            var xy_value = document.getElementById('xy_value');
            var location_value = document.getElementById('location_value');
            var temp_value = document.getElementById('temp_value');
            var pollution_value = document.getElementById('pollution_value');
            
            
            //карта
            function addMarker(x, y, id)    {
                var pos = { 
                    lat: x,
                    lng: y
                };
                var marker = new H.map.Marker(pos);
                marker.setData({
                    'id' : id
                });
                M.Map.addObject(marker);                
            }
            
            var M = {
               'Init' : {    // developer.here.com for app_id and app_code
                 'app_id':   'li5VO7vpWnNOa3zo51vT',
                 'app_code': 'TiLWurluCwGBtp_QDTU1bQ',
                 useHTTPS: true,
                 'style': 'alps'
               },
               'Behavior' : {},       // Управление событиями карты
               'Container' :   {},       // Контейнер для отображения карты
               'PlacesService':{},       // Сервис Places API
               'PlacesGroup':  {},       // Группа для хранения точек интереса
               'Lat' :         55.751,   // Широта (центр карты)
               'Lng' :         37.620,   // Долгота (центр карты)
               'Layers' :      {},       // Список картографических основ
               'Map' :         {},       // Объект карты
               'Platform' :    {},       // Платформа HERE API
               'UI' :          {},       // Пользовательский интерфейс
               'Zoom' :        12        // 1 == весь мир, 15 == масштаб улицы
            };
            M.Container = document.querySelector('#map');
            // инициализация платформы
            M.Platform = new H.service.Platform(M.Init);     
            // Получение списка базовых карт
            M.Layers = M.Platform.createDefaultLayers({lg:"rus"});
            //инициализация карты
            var initPos = {
              zoom: 10,
              center: { lng: 30.30611, lat: 59.93314 }
            };    
            M.Map = new H.Map(M.Container, M.Layers.normal.map, initPos);
            // интерактивное поведение
            var mapEvents = new H.mapevents.MapEvents(M.Map);
            M.Behavior =  new H.mapevents.Behavior(mapEvents);
                    
            addMarker(59.93314, 30.30611, 1);
            
            M.Map.addEventListener('tap', function (evt) {
                if (evt.target instanceof H.map.Marker) {
                    var currentMarkerId = evt.target.getData().id;
                    setDevice(currentMarkerId);
                }
            });
            
            function setDevice(markerId)  {
                console.log('set device '+markerId);
                currentDevice = markerId;
                id_value.innerHTML = markerId;
                xy_value.innerHTML = data[markerId].x + ' ' + data[markerId].y;
                location_value.innerHTML = data[markerId].location;
                temp_value.innerHTML = data[markerId].temp;
                pollution_value.innerHTML = data[markerId].pollution;
            }
            
            
            
            //запросы
            function request()  {
                /*
                var request = new XMLHttpRequest();
                request.open('GET', 'http://', false);
                request.send();

                // Если код ответа сервера не 200, то это ошибка
                if (request.status != 200) {
                    alert( request.status + ': ' + request.statusText );
                } else {
                    var answer = request.responseText;
                }
                */
                console.log("timed func invoked");
            }
            
            var minX = 59.85115;
            var minY = 30.16413;
            var maxX = 60.02331;
            var maxY = 30.50722;
            let freq = 10;
            setInterval(1 / freq, request);     
            
        </script>
        
        <script src="https://www.google.com/jsapi"></script>
        <script>  
            let arr = new Array;
            arr.push(['t', 'T']);
            for (var i = 0; i < 50; i++)    {
                arr.push([i, Math.sin(i)]);   
            }
            
            var options = {
                hAxis: {title: 'Время, мин', 
                        titleTextStyle: {color: '#00F7FF'},
                        textStyle: {color: "009DA2"},  
                        gridlines: {color: "#009DA2"}},
                vAxis: {title: 'Температура, °С',
                        titleTextStyle: {color: '00F7FF'},
                        textStyle: {color: "009DA2"},    
                        gridlines: {color: '#009DA2'}},
                backgroundColor: '#343a40',
                series: [{color: '#00F7FF'}],
                curveType: 'function'
            };
            
            google.load("visualization", "1", {packages:["corechart"]});
            google.setOnLoadCallback(drawChart);                            
            
            
            function drawChart() {                                 
                let temp_chart = new google.visualization.LineChart(document.getElementById('temp_chart'));
                let pol_chart = new google.visualization.LineChart(document.getElementById('pol_chart'));
                let data = google.visualization.arrayToDataTable(arr);
                temp_chart.draw(data, options);
                pol_chart.draw(data, options);
            }
            
            function addPoint(value) {
                arr.pop();
                arr.push(value);
                drawChart();
            }
          </script>
    </body>
</html>